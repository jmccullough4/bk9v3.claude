<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueK9 - Tactical Bluetooth Surveillance</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='logo/favicon.svg') }}">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <!-- Alert Audio -->
    <audio id="alertSound" preload="auto">
        <source src="{{ url_for('static', filename='sounds/alert.mp3') }}" type="audio/mpeg">
        <source src="{{ url_for('static', filename='sounds/alert.wav') }}" type="audio/wav">
    </audio>

    <!-- Target Alert Modal -->
    <div id="targetAlertModal" class="modal hidden">
        <div class="modal-content alert-modal">
            <div class="alert-header">
                <span class="alert-icon">&#9888;</span>
                <span class="alert-title">TARGET DETECTED</span>
            </div>
            <div class="alert-body">
                <div class="alert-device-info">
                    <span id="alertBdAddress">--:--:--:--:--:--</span>
                    <span id="alertDeviceName">Unknown Device</span>
                </div>
                <div class="alert-details" id="alertDetails"></div>
                <div class="alert-system-location">
                    <span class="location-label">System Location:</span>
                    <span id="alertSystemLocation">--</span>
                    <a id="alertMapLink" href="#" target="_blank" class="map-link">View Map</a>
                </div>
            </div>
            <div class="alert-buttons">
                <button class="btn btn-secondary" onclick="copyAlertDetails()">COPY DETAILS</button>
                <button class="btn btn-primary" onclick="closeAlertModal()">ACKNOWLEDGE</button>
            </div>
        </div>
    </div>

    <!-- Device Info Modal -->
    <div id="deviceInfoModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <span>DEVICE INFORMATION</span>
                <button class="modal-close" onclick="closeDeviceInfoModal()">&times;</button>
            </div>
            <div class="modal-body" id="deviceInfoContent">
                <!-- Device info will be populated here -->
            </div>
        </div>
    </div>

    <!-- Restart/Update Overlay -->
    <div id="restartOverlay" class="restart-overlay hidden">
        <div class="restart-content">
            <div class="restart-spinner">
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
            </div>
            <div class="restart-text" id="restartTitle">SYSTEM RESTARTING</div>
            <div class="restart-subtext" id="restartSubtext">Please wait while BlueK9 reinitializes...</div>
            <div class="restart-phase-list" id="restartPhaseList">
                <!-- Phases populated by JS -->
            </div>
            <div class="restart-progress">
                <div class="restart-progress-bar" id="restartProgressBar"></div>
            </div>
            <div class="restart-status" id="restartStatus">Stopping services...</div>
            <div class="restart-countdown hidden" id="restartCountdown">
                <span class="countdown-number">10</span>
                <span class="countdown-label">SECONDS</span>
            </div>
        </div>
    </div>

    <!-- Add Route Modal -->
    <div id="addRouteModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <span>ADD NETWORK ROUTE</span>
                <button class="modal-close" onclick="closeAddRouteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <label>Network CIDR:</label>
                    <input type="text" id="routeNetwork" placeholder="10.0.0.0/24" class="input">
                </div>
                <div class="form-row">
                    <label>Description:</label>
                    <input type="text" id="routeDescription" placeholder="Route description" class="input">
                </div>
                <div class="form-row">
                    <label>Peer:</label>
                    <select id="routePeer" class="input">
                        <option value="">-- Select Peer --</option>
                    </select>
                </div>
                <div class="form-row">
                    <label>Metric:</label>
                    <input type="number" id="routeMetric" value="9999" min="0" max="99999" class="input">
                </div>
                <div class="form-row">
                    <label class="toggle">
                        <input type="checkbox" id="routeMasquerade" checked>
                        <span class="toggle-slider"></span>
                        <span class="toggle-label">Masquerade</span>
                    </label>
                </div>
                <div class="btn-group mt-10">
                    <button class="btn btn-primary" onclick="submitAddRoute()">ADD ROUTE</button>
                    <button class="btn btn-secondary" onclick="closeAddRouteModal()">CANCEL</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tools Modal -->
    <div id="toolsModal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <span>&#128295; ANALYSIS TOOLS</span>
                <button class="modal-close" onclick="closeToolsModal()">&times;</button>
            </div>
            <div class="modal-body tools-body">
                <!-- Tools Tabs -->
                <div class="tools-tabs">
                    <button class="tools-tab active" onclick="showToolsTab('tracking')">Target Tracking</button>
                    <button class="tools-tab" onclick="showToolsTab('phonebook')">Phone Book</button>
                    <button class="tools-tab" onclick="showToolsTab('services')">Services</button>
                    <button class="tools-tab" onclick="showToolsTab('analysis')">Analysis</button>
                    <button class="tools-tab" onclick="showToolsTab('cyber')">Cyber Tools</button>
                </div>

                <!-- Target Tracking Tab -->
                <div id="toolsTracking" class="tools-content active">
                    <div class="tools-group">
                        <h3>Active Geolocation Tracking</h3>
                        <p class="tools-hint">Track a specific target device and estimate its location using RSSI triangulation.</p>
                        <div class="form-row">
                            <label>Target Device:</label>
                            <select id="toolsTrackTargetSelect" class="input">
                                <option value="">Select target...</option>
                            </select>
                        </div>
                        <div class="tracking-status-display mt-10">
                            <div class="tracking-compass">
                                <div class="compass-ring">
                                    <div class="compass-arrow" id="toolsCompassArrow"></div>
                                    <div class="compass-rssi" id="toolsCompassRssi">--</div>
                                </div>
                            </div>
                            <div class="tracking-info">
                                <div class="tracking-stat">
                                    <span class="stat-label">STATUS:</span>
                                    <span class="stat-value" id="toolsTrackingStatus">IDLE</span>
                                </div>
                                <div class="tracking-stat">
                                    <span class="stat-label">RSSI:</span>
                                    <span class="stat-value" id="toolsTrackingRssi">--</span>
                                </div>
                                <div class="tracking-stat">
                                    <span class="stat-label">BEARING:</span>
                                    <span class="stat-value" id="toolsTrackingBearing">--</span>
                                </div>
                                <div class="tracking-stat">
                                    <span class="stat-label">DISTANCE:</span>
                                    <span class="stat-value" id="toolsTrackingDistance">--</span>
                                </div>
                            </div>
                        </div>
                        <div class="btn-group mt-10">
                            <button class="btn btn-success" id="toolsBtnStartTrack" onclick="startToolsTracking()">
                                &#9654; START TRACKING
                            </button>
                            <button class="btn btn-danger" id="toolsBtnStopTrack" onclick="stopToolsTracking()" disabled>
                                &#9632; STOP
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Phone Book Tab -->
                <div id="toolsPhonebook" class="tools-content">
                    <div class="tools-group">
                        <h3>Bluetooth Phone Book Access (PBAP)</h3>
                        <p class="tools-hint">Attempt to read phone book data from target Bluetooth devices. Requires device pairing or vulnerable target.</p>
                        <div class="form-row">
                            <label>Target Device:</label>
                            <select id="pbapTargetSelect" class="input">
                                <option value="">Select target...</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label>Phone Book Type:</label>
                            <select id="pbapBookType" class="input">
                                <option value="pb">Main Phone Book (pb)</option>
                                <option value="ich">Incoming Calls (ich)</option>
                                <option value="och">Outgoing Calls (och)</option>
                                <option value="mch">Missed Calls (mch)</option>
                                <option value="cch">Combined Calls (cch)</option>
                            </select>
                        </div>
                        <div class="btn-group mt-10">
                            <button class="btn btn-primary" onclick="readPhoneBook()">
                                &#128214; READ PHONE BOOK
                            </button>
                        </div>
                        <div class="pbap-results mt-10 hidden" id="pbapResults">
                            <div class="pbap-results-header">PHONE BOOK ENTRIES</div>
                            <div class="pbap-results-list" id="pbapResultsList">
                                <!-- Results populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Services Tab -->
                <div id="toolsServices" class="tools-content">
                    <div class="tools-group">
                        <h3>Service Discovery Protocol (SDP)</h3>
                        <p class="tools-hint">Discover available Bluetooth services on target devices.</p>
                        <div class="form-row">
                            <label>Target Device:</label>
                            <select id="sdpTargetSelect" class="input">
                                <option value="">Select target...</option>
                            </select>
                        </div>
                        <div class="btn-group mt-10">
                            <button class="btn btn-primary" onclick="discoverServices()">
                                &#128269; DISCOVER SERVICES
                            </button>
                        </div>
                        <div class="sdp-results mt-10 hidden" id="sdpResults">
                            <div class="sdp-results-header">DISCOVERED SERVICES</div>
                            <div class="sdp-results-list" id="sdpResultsList">
                                <!-- Results populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analysis Tab -->
                <div id="toolsAnalysis" class="tools-content">
                    <div class="tools-group">
                        <h3>Device Analysis</h3>
                        <p class="tools-hint">Deep analysis of detected Bluetooth devices.</p>
                        <div class="form-row">
                            <label>Target Device:</label>
                            <select id="analysisTargetSelect" class="input">
                                <option value="">Select target...</option>
                            </select>
                        </div>
                        <div class="analysis-options">
                            <label class="toggle">
                                <input type="checkbox" id="analysisOuiLookup" checked>
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">OUI/Manufacturer Lookup</span>
                            </label>
                            <label class="toggle">
                                <input type="checkbox" id="analysisDeviceClass" checked>
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Device Class Analysis</span>
                            </label>
                            <label class="toggle">
                                <input type="checkbox" id="analysisServiceScan">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Service Scan (slow)</span>
                            </label>
                        </div>
                        <div class="btn-group mt-10">
                            <button class="btn btn-primary" onclick="runDeviceAnalysis()">
                                &#128270; ANALYZE DEVICE
                            </button>
                        </div>
                        <div class="analysis-results mt-10 hidden" id="analysisResults">
                            <div class="analysis-results-content" id="analysisResultsContent">
                                <!-- Results populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cyber Tools Tab - Comprehensive Bluetooth Arsenal -->
                <div id="toolsCyber" class="tools-content">
                    <!-- Cyber Tools Sub-Navigation -->
                    <div class="cyber-nav">
                        <button class="cyber-nav-btn active" onclick="showCyberCategory('recon')" data-category="recon">
                            <span class="cyber-nav-icon">&#128269;</span>
                            <span class="cyber-nav-label">Recon</span>
                        </button>
                        <button class="cyber-nav-btn" onclick="showCyberCategory('sniff')" data-category="sniff">
                            <span class="cyber-nav-icon">&#128225;</span>
                            <span class="cyber-nav-label">Sniff</span>
                        </button>
                        <button class="cyber-nav-btn" onclick="showCyberCategory('exploit')" data-category="exploit">
                            <span class="cyber-nav-icon">&#9889;</span>
                            <span class="cyber-nav-label">Exploit</span>
                        </button>
                        <button class="cyber-nav-btn" onclick="showCyberCategory('mitm')" data-category="mitm">
                            <span class="cyber-nav-icon">&#128279;</span>
                            <span class="cyber-nav-label">MITM</span>
                        </button>
                        <button class="cyber-nav-btn" onclick="showCyberCategory('inject')" data-category="inject">
                            <span class="cyber-nav-icon">&#9000;</span>
                            <span class="cyber-nav-label">Inject</span>
                        </button>
                        <button class="cyber-nav-btn" onclick="showCyberCategory('firmware')" data-category="firmware">
                            <span class="cyber-nav-icon">&#128187;</span>
                            <span class="cyber-nav-label">Firmware</span>
                        </button>
                        <button class="cyber-nav-btn" onclick="showCyberCategory('utils')" data-category="utils">
                            <span class="cyber-nav-icon">&#128295;</span>
                            <span class="cyber-nav-label">Utils</span>
                        </button>
                    </div>

                    <!-- Tool Status Banner -->
                    <div class="cyber-status-banner" id="cyberStatusBanner">
                        <div class="status-item">
                            <span class="status-dot" id="cyberToolsStatusDot"></span>
                            <span id="cyberToolsStatusText">Checking tools...</span>
                        </div>
                        <div class="status-actions">
                            <button class="btn btn-sm btn-primary" id="btnInstallAll" onclick="installAllTools()">&#128229; Install All</button>
                            <button class="btn btn-sm btn-secondary" onclick="checkCyberToolsStatus()">&#8635; Refresh</button>
                        </div>
                    </div>

                    <!-- ==================== RECONNAISSANCE ==================== -->
                    <div id="cyberRecon" class="cyber-category active">
                        <div class="cyber-category-header">
                            <h3>&#128269; Reconnaissance & Discovery</h3>
                            <p>Advanced Bluetooth device discovery, enumeration, and fingerprinting tools</p>
                        </div>

                        <!-- Blue Hydra -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128038;</span>
                                    <span class="tool-name">Blue Hydra</span>
                                    <span class="tool-badge">Discovery</span>
                                </div>
                                <div class="tool-status" id="blueHydraStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Passive Bluetooth discovery service using Ubertooth and standard adapters. Detects discoverable and non-discoverable devices.</p>
                                <div class="tool-options">
                                    <label class="toggle">
                                        <input type="checkbox" id="blueHydraUbertooth" checked>
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">Use Ubertooth</span>
                                    </label>
                                    <label class="toggle">
                                        <input type="checkbox" id="blueHydraPassive">
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">Passive Only</span>
                                    </label>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-success" onclick="startBlueHydra()">&#9654; START</button>
                                    <button class="btn btn-danger" onclick="stopBlueHydra()" disabled id="btnStopBlueHydra">&#9632; STOP</button>
                                    <button class="btn btn-secondary" onclick="installTool('blue_hydra')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="blueHydraOutput"></div>
                            </div>
                        </div>

                        <!-- BLESuite -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128272;</span>
                                    <span class="tool-name">BLESuite</span>
                                    <span class="tool-badge">BLE Testing</span>
                                </div>
                                <div class="tool-status" id="blesuiteStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Comprehensive BLE security testing framework. Enumerate services, characteristics, and test for common vulnerabilities.</p>
                                <div class="form-row">
                                    <label>Target:</label>
                                    <div class="input-with-btn">
                                        <input type="text" id="blesuiteTarget" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                        <button class="btn btn-sm" onclick="fillFromSurvey('blesuiteTarget')">&#8592;</button>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <label>Scan Type:</label>
                                    <select id="blesuiteScanType" class="input">
                                        <option value="enum">Enumerate Services</option>
                                        <option value="read">Read All Characteristics</option>
                                        <option value="write_test">Write Test</option>
                                        <option value="fuzz">Fuzzing Mode</option>
                                    </select>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-primary" onclick="runBLESuite()">&#9654; RUN SCAN</button>
                                    <button class="btn btn-secondary" onclick="installTool('blesuite')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="blesuiteOutput"></div>
                            </div>
                        </div>

                        <!-- Bleah -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128123;</span>
                                    <span class="tool-name">Bleah</span>
                                    <span class="tool-badge">BLE Scanner</span>
                                </div>
                                <div class="tool-status" id="bleahStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">BLE scanner with enumeration capabilities. Quick discovery of nearby BLE devices with GATT info.</p>
                                <div class="form-row">
                                    <label>Target (optional):</label>
                                    <input type="text" id="bleahTarget" class="input" placeholder="Leave blank for scan all">
                                </div>
                                <div class="tool-options">
                                    <label class="toggle">
                                        <input type="checkbox" id="bleahEnumerate" checked>
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">Enumerate GATT</span>
                                    </label>
                                    <label class="toggle">
                                        <input type="checkbox" id="bleahForce">
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">Force Connection</span>
                                    </label>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-primary" onclick="runBleah()">&#9654; SCAN</button>
                                    <button class="btn btn-secondary" onclick="installTool('bleah')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="bleahOutput"></div>
                            </div>
                        </div>

                        <!-- Redfang -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128126;</span>
                                    <span class="tool-name">Redfang</span>
                                    <span class="tool-badge">Hidden Device</span>
                                </div>
                                <div class="tool-status" id="redfangStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Find non-discoverable Bluetooth devices by brute-forcing the last 6 bytes of the BD address.</p>
                                <div class="form-row">
                                    <label>OUI Prefix:</label>
                                    <input type="text" id="redfangOui" class="input" placeholder="AA:BB:CC (first 3 bytes)">
                                </div>
                                <div class="form-row">
                                    <label>Range:</label>
                                    <select id="redfangRange" class="input">
                                        <option value="16">16 addresses</option>
                                        <option value="256">256 addresses</option>
                                        <option value="4096">4096 addresses (slow)</option>
                                    </select>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-warning" onclick="runRedfang()">&#9654; BRUTE FORCE</button>
                                </div>
                                <div class="tool-output hidden" id="redfangOutput"></div>
                            </div>
                        </div>

                        <!-- Spooftooph -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128065;</span>
                                    <span class="tool-name">Spooftooph</span>
                                    <span class="tool-badge">Fingerprint</span>
                                </div>
                                <div class="tool-status" id="spooftoophStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Clone a Bluetooth device's profile (name, class, address). Useful for impersonation testing.</p>
                                <div class="form-row">
                                    <label>Clone From:</label>
                                    <div class="input-with-btn">
                                        <input type="text" id="spooftoophSource" class="input" placeholder="Source BD Address">
                                        <button class="btn btn-sm" onclick="fillFromSurvey('spooftoophSource')">&#8592;</button>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <label>Interface:</label>
                                    <select id="spooftoophInterface" class="input">
                                        <option value="hci0">hci0</option>
                                        <option value="hci1">hci1</option>
                                    </select>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-warning" onclick="runSpooftooph()">&#128065; CLONE PROFILE</button>
                                </div>
                                <div class="tool-output hidden" id="spooftoophOutput"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== SNIFFING ==================== -->
                    <div id="cyberSniff" class="cyber-category">
                        <div class="cyber-category-header">
                            <h3>&#128225; Sniffing & Capture</h3>
                            <p>Bluetooth packet capture, protocol analysis, and traffic monitoring</p>
                        </div>

                        <!-- Ubertooth Spectrum -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128225;</span>
                                    <span class="tool-name">Ubertooth Spectrum</span>
                                    <span class="tool-badge">2.4GHz Analyzer</span>
                                </div>
                                <div class="tool-status" id="ubertoothSpectrumStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">2.4GHz spectrum analyzer using Ubertooth hardware. Visualize Bluetooth and WiFi activity in real-time.</p>
                                <div class="spectrum-display" id="spectrumDisplay">
                                    <canvas id="spectrumCanvas" width="600" height="200"></canvas>
                                </div>
                                <div class="tool-options">
                                    <label class="toggle">
                                        <input type="checkbox" id="spectrumLive" checked>
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">Live Update</span>
                                    </label>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-success" onclick="startSpectrum()">&#9654; START</button>
                                    <button class="btn btn-danger" onclick="stopSpectrum()" disabled id="btnStopSpectrum">&#9632; STOP</button>
                                </div>
                            </div>
                        </div>

                        <!-- Ubertooth BTLE Sniffer -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128752;</span>
                                    <span class="tool-name">Ubertooth BTLE</span>
                                    <span class="tool-badge">BLE Sniffer</span>
                                </div>
                                <div class="tool-status" id="ubertoothBtleStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Capture BLE packets in promiscuous mode. Follow connections and capture encrypted traffic.</p>
                                <div class="form-row">
                                    <label>Mode:</label>
                                    <select id="ubertoothBtleMode" class="input">
                                        <option value="follow">Follow New Connections</option>
                                        <option value="target">Target Specific Device</option>
                                        <option value="promiscuous">Promiscuous Mode</option>
                                    </select>
                                </div>
                                <div class="form-row" id="ubertoothBtleTargetRow">
                                    <label>Target:</label>
                                    <input type="text" id="ubertoothBtleTarget" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                </div>
                                <div class="form-row">
                                    <label>Output:</label>
                                    <select id="ubertoothBtleOutput" class="input">
                                        <option value="pcap">PCAP File</option>
                                        <option value="wireshark">Wireshark (Live)</option>
                                        <option value="console">Console</option>
                                    </select>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-success" onclick="startUbertoothBtle()">&#9654; CAPTURE</button>
                                    <button class="btn btn-danger" onclick="stopUbertoothBtle()" disabled id="btnStopUbertoothBtle">&#9632; STOP</button>
                                </div>
                                <div class="tool-output hidden" id="ubertoothBtleOutput"></div>
                            </div>
                        </div>

                        <!-- Btlejack -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#127919;</span>
                                    <span class="tool-name">BTLEJack</span>
                                    <span class="tool-badge">BLE Hijacker</span>
                                </div>
                                <div class="tool-status" id="btlejackStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Sniff, jam, and hijack BLE connections using Micro:Bit or nRF51 devices.</p>
                                <div class="form-row">
                                    <label>Mode:</label>
                                    <select id="btlejackMode" class="input">
                                        <option value="sniff">Sniff Connections</option>
                                        <option value="jam">Jam Connection</option>
                                        <option value="hijack">Hijack Connection</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label>Access Address:</label>
                                    <input type="text" id="btlejackAA" class="input" placeholder="0x12345678 (or auto-detect)">
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-warning" onclick="runBtlejack()">&#9654; RUN</button>
                                    <button class="btn btn-secondary" onclick="installTool('btlejack')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="btlejackOutput"></div>
                            </div>
                        </div>

                        <!-- Crackle -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128274;</span>
                                    <span class="tool-name">Crackle</span>
                                    <span class="tool-badge">BLE Crypto</span>
                                </div>
                                <div class="tool-status" id="crackleStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Crack BLE encryption by exploiting weak pairing. Works on BLE Legacy Pairing (LE Legacy Pairing with Temporary Key).</p>
                                <div class="form-row">
                                    <label>PCAP File:</label>
                                    <input type="file" id="cracklePcap" class="input" accept=".pcap,.pcapng">
                                </div>
                                <div class="tool-options">
                                    <label class="toggle">
                                        <input type="checkbox" id="crackleDecrypt" checked>
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">Decrypt Traffic</span>
                                    </label>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-warning" onclick="runCrackle()">&#128274; CRACK</button>
                                    <button class="btn btn-secondary" onclick="installTool('crackle')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="crackleOutput"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== EXPLOITATION ==================== -->
                    <div id="cyberExploit" class="cyber-category">
                        <div class="cyber-category-header">
                            <h3>&#9889; Exploitation & Vulnerabilities</h3>
                            <p>Bluetooth vulnerability scanners and exploit tools for authorized security testing</p>
                        </div>

                        <!-- BlueToolkit - Primary Framework -->
                        <div class="cyber-tool-card exploit-card featured-tool">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128737;</span>
                                    <span class="tool-name">BlueToolkit</span>
                                    <span class="tool-badge critical">43 EXPLOITS</span>
                                    <span class="tool-badge">Automotive</span>
                                </div>
                                <div class="tool-status" id="bluetoolkitStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Comprehensive Bluetooth Classic vulnerability testing framework with 43 exploits. Supports BlueBorne, KNOB, BIAS, Braktooth, BleedingTooth and more. Found 64 vulnerabilities in 22 car models.</p>
                                <div class="bluetoolkit-stats">
                                    <div class="stat-item"><span class="stat-num">43</span><span class="stat-label">Exploits</span></div>
                                    <div class="stat-item"><span class="stat-num">22</span><span class="stat-label">Cars Tested</span></div>
                                    <div class="stat-item"><span class="stat-num">64</span><span class="stat-label">CVEs Found</span></div>
                                </div>
                                <div class="form-row">
                                    <label>Target:</label>
                                    <div class="input-with-btn">
                                        <input type="text" id="bluetoolkitTarget" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                        <button class="btn btn-sm" onclick="fillFromSurvey('bluetoolkitTarget')">&#8592;</button>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <label>Mode:</label>
                                    <select id="bluetoolkitMode" class="input">
                                        <option value="all">Full Scan (All 43 Exploits)</option>
                                        <option value="recon">Reconnaissance Only</option>
                                        <option value="quick">Quick Scan (Critical Only)</option>
                                        <option value="automotive">Automotive Focus</option>
                                        <option value="custom">Custom Exploits</option>
                                    </select>
                                </div>
                                <div class="form-row hidden" id="bluetoolkitCustomRow">
                                    <label>Select Exploits:</label>
                                    <select id="bluetoolkitExploits" class="input" multiple size="6">
                                        <optgroup label="Critical - RCE">
                                            <option value="my_name_is_keyboard">CVE-2023-45866 (HID Injection)</option>
                                            <option value="cve_2017_0785">CVE-2017-0785 (BlueBorne Info Leak)</option>
                                            <option value="cve_2018_19860">CVE-2018-19860 (Memory Exec)</option>
                                            <option value="cve_2017_1000251">CVE-2017-1000251 (Linux RCE)</option>
                                            <option value="cve_2020_12351">CVE-2020-12351 (BleedingTooth)</option>
                                        </optgroup>
                                        <optgroup label="MITM Attacks">
                                            <option value="knob">KNOB Attack (CVE-2019-9506)</option>
                                            <option value="bias">BIAS (CVE-2020-10135)</option>
                                            <option value="nino">NiNo MITM</option>
                                            <option value="method_confusion">Method Confusion (CVE-2020-10134)</option>
                                            <option value="cve_2018_5383">CVE-2018-5383 (Crypto Attack)</option>
                                        </optgroup>
                                        <optgroup label="DoS - Braktooth">
                                            <option value="invalid_max_slot">Invalid Max Slot (V13)</option>
                                            <option value="duplicated_iocap">Duplicated IOCAP (V3)</option>
                                            <option value="truncated_sco_request">Truncated SCO (V2)</option>
                                            <option value="feature_resp_flooding">Feature Flooding (V4)</option>
                                            <option value="lmp_auto_rate_overflow">LMP Auto Rate (V5)</option>
                                            <option value="au_rand_flooding">AU Rand Flooding (V12)</option>
                                            <option value="paging_scan_deadlock">Paging Deadlock (V16)</option>
                                        </optgroup>
                                        <optgroup label="Info Leaks">
                                            <option value="cve_2020_12352">CVE-2020-12352 (BadChoice)</option>
                                            <option value="cve_2017_1000250">CVE-2017-1000250 (BlueBorne)</option>
                                            <option value="sdp_leak">SDP Information Leak</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label>Hardware:</label>
                                    <select id="bluetoolkitHardware" class="input">
                                        <option value="auto">Auto-detect</option>
                                        <option value="standard">Standard Adapter</option>
                                        <option value="esp32">ESP-WROVER-KIT (Braktooth)</option>
                                        <option value="nexus5">Nexus 5 (InternalBlue)</option>
                                        <option value="cyw920819">CYW920819 (BIAS/BLUR)</option>
                                    </select>
                                </div>
                                <div class="tool-options">
                                    <label class="toggle">
                                        <input type="checkbox" id="bluetoolkitCheckpoint">
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">Resume from Checkpoint</span>
                                    </label>
                                    <label class="toggle">
                                        <input type="checkbox" id="bluetoolkitReport" checked>
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">Generate Report</span>
                                    </label>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-danger" onclick="runBlueToolkit()">&#9889; RUN SCAN</button>
                                    <button class="btn btn-warning" onclick="runBlueToolkitRecon()">&#128269; RECON ONLY</button>
                                    <button class="btn btn-secondary" onclick="installTool('bluetoolkit')">&#128229; INSTALL</button>
                                    <button class="btn btn-secondary" onclick="listBlueToolkitExploits()">&#128203; LIST EXPLOITS</button>
                                </div>
                                <div class="tool-output hidden" id="bluetoolkitOutput"></div>
                            </div>
                        </div>

                        <!-- BlueBorne Scanner -->
                        <div class="cyber-tool-card exploit-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128128;</span>
                                    <span class="tool-name">BlueBorne Scanner</span>
                                    <span class="tool-badge critical">CVE-2017</span>
                                </div>
                                <div class="tool-status" id="blueborneStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Scan for BlueBorne vulnerabilities (CVE-2017-0781, 0782, 0783, 0785). Affects Android, Linux, iOS, Windows.</p>
                                <div class="vuln-info">
                                    <div class="vuln-item"><span class="vuln-id">CVE-2017-0781</span> Android RCE (BNEP)</div>
                                    <div class="vuln-item"><span class="vuln-id">CVE-2017-0782</span> Android RCE (BNEP)</div>
                                    <div class="vuln-item"><span class="vuln-id">CVE-2017-0783</span> Android MITM</div>
                                    <div class="vuln-item"><span class="vuln-id">CVE-2017-0785</span> Android Info Leak</div>
                                    <div class="vuln-item"><span class="vuln-id">CVE-2017-1000251</span> Linux RCE</div>
                                </div>
                                <div class="form-row">
                                    <label>Target:</label>
                                    <div class="input-with-btn">
                                        <input type="text" id="blueborneTarget" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                        <button class="btn btn-sm" onclick="fillFromSurvey('blueborneTarget')">&#8592;</button>
                                    </div>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-danger" onclick="runBlueborneScan()">&#128128; SCAN</button>
                                    <button class="btn btn-secondary" onclick="installTool('blueborne')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="blueborneOutput"></div>
                            </div>
                        </div>

                        <!-- KNOB Attack -->
                        <div class="cyber-tool-card exploit-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128477;</span>
                                    <span class="tool-name">KNOB Attack</span>
                                    <span class="tool-badge critical">CVE-2019-9506</span>
                                </div>
                                <div class="tool-status" id="knobStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Key Negotiation of Bluetooth - forces weak encryption during connection. Affects all Bluetooth BR/EDR devices.</p>
                                <div class="form-row">
                                    <label>Target:</label>
                                    <div class="input-with-btn">
                                        <input type="text" id="knobTarget" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                        <button class="btn btn-sm" onclick="fillFromSurvey('knobTarget')">&#8592;</button>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <label>Entropy Bytes:</label>
                                    <select id="knobEntropy" class="input">
                                        <option value="1">1 byte (weakest)</option>
                                        <option value="2">2 bytes</option>
                                        <option value="3">3 bytes</option>
                                        <option value="7">7 bytes</option>
                                    </select>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-danger" onclick="runKnobAttack()">&#9889; ATTACK</button>
                                    <button class="btn btn-secondary" onclick="installTool('knob')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="knobOutput"></div>
                            </div>
                        </div>

                        <!-- BIAS Attack -->
                        <div class="cyber-tool-card exploit-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128373;</span>
                                    <span class="tool-name">BIAS Attack</span>
                                    <span class="tool-badge critical">CVE-2020-10135</span>
                                </div>
                                <div class="tool-status" id="biasStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Bluetooth Impersonation Attack - bypass authentication and impersonate a trusted device.</p>
                                <div class="form-row">
                                    <label>Target:</label>
                                    <input type="text" id="biasTarget" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                </div>
                                <div class="form-row">
                                    <label>Impersonate:</label>
                                    <input type="text" id="biasImpersonate" class="input" placeholder="Device to impersonate">
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-danger" onclick="runBiasAttack()">&#128373; IMPERSONATE</button>
                                    <button class="btn btn-secondary" onclick="installTool('bias')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="biasOutput"></div>
                            </div>
                        </div>

                        <!-- SDP Leak -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128203;</span>
                                    <span class="tool-name">SDP Leak-It</span>
                                    <span class="tool-badge">Info Leak</span>
                                </div>
                                <div class="tool-status" id="sdpLeakStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Exploit SDP to leak information from Bluetooth devices. Extract service records, device info.</p>
                                <div class="form-row">
                                    <label>Target:</label>
                                    <div class="input-with-btn">
                                        <input type="text" id="sdpLeakTarget" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                        <button class="btn btn-sm" onclick="fillFromSurvey('sdpLeakTarget')">&#8592;</button>
                                    </div>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-warning" onclick="runSdpLeak()">&#128203; EXTRACT</button>
                                </div>
                                <div class="tool-output hidden" id="sdpLeakOutput"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== MITM ==================== -->
                    <div id="cyberMitm" class="cyber-category">
                        <div class="cyber-category-header">
                            <h3>&#128279; Man-in-the-Middle</h3>
                            <p>Bluetooth traffic interception, proxy, and relay tools</p>
                        </div>

                        <!-- BTLEJuice -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#127863;</span>
                                    <span class="tool-name">BTLEJuice</span>
                                    <span class="tool-badge">BLE MITM</span>
                                </div>
                                <div class="tool-status" id="btlejuiceStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">BLE Man-in-the-Middle framework. Intercept, modify, and replay BLE traffic between devices.</p>
                                <div class="tool-requirements">
                                    <span class="req-label">Requires:</span> 2x BLE adapters (1 peripheral, 1 central)
                                </div>
                                <div class="form-row">
                                    <label>Target Device:</label>
                                    <input type="text" id="btlejuiceTarget" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                </div>
                                <div class="form-row">
                                    <label>Proxy Interface:</label>
                                    <select id="btlejuiceInterface" class="input">
                                        <option value="hci0">hci0</option>
                                        <option value="hci1">hci1</option>
                                    </select>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-success" onclick="startBtlejuice()">&#9654; START PROXY</button>
                                    <button class="btn btn-danger" onclick="stopBtlejuice()" disabled id="btnStopBtlejuice">&#9632; STOP</button>
                                    <button class="btn btn-secondary" onclick="installTool('btlejuice')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="btlejuiceOutput"></div>
                            </div>
                        </div>

                        <!-- GATTacker -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128737;</span>
                                    <span class="tool-name">GATTacker</span>
                                    <span class="tool-badge">BLE Clone</span>
                                </div>
                                <div class="tool-status" id="gattackerStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Clone BLE devices and intercept connections. Create a rogue device that mimics the target.</p>
                                <div class="form-row">
                                    <label>Target Device:</label>
                                    <input type="text" id="gattackerTarget" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                </div>
                                <div class="tool-options">
                                    <label class="toggle">
                                        <input type="checkbox" id="gattackerRelay" checked>
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">Relay to Original</span>
                                    </label>
                                    <label class="toggle">
                                        <input type="checkbox" id="gattackerLog" checked>
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">Log Traffic</span>
                                    </label>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-warning" onclick="runGattacker()">&#128737; CLONE & INTERCEPT</button>
                                    <button class="btn btn-secondary" onclick="installTool('gattacker')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="gattackerOutput"></div>
                            </div>
                        </div>

                        <!-- BT Proxy -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128260;</span>
                                    <span class="tool-name">BT Proxy</span>
                                    <span class="tool-badge">Classic MITM</span>
                                </div>
                                <div class="tool-status" id="btproxyStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Classic Bluetooth MITM proxy. Intercept RFCOMM, L2CAP connections.</p>
                                <div class="form-row">
                                    <label>Master Device:</label>
                                    <input type="text" id="btproxyMaster" class="input" placeholder="Phone/Laptop">
                                </div>
                                <div class="form-row">
                                    <label>Slave Device:</label>
                                    <input type="text" id="btproxySlave" class="input" placeholder="Headset/Keyboard">
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-warning" onclick="runBtproxy()">&#128260; START PROXY</button>
                                    <button class="btn btn-secondary" onclick="installTool('btproxy')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="btproxyOutput"></div>
                            </div>
                        </div>

                        <!-- BLE Replay -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#9654;&#9654;</span>
                                    <span class="tool-name">BLE Replay</span>
                                    <span class="tool-badge">Traffic Replay</span>
                                </div>
                                <div class="tool-status" id="blereplayStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Replay captured BLE traffic. Useful for testing authentication bypasses.</p>
                                <div class="form-row">
                                    <label>Capture File:</label>
                                    <input type="file" id="blereplayFile" class="input" accept=".pcap,.json">
                                </div>
                                <div class="form-row">
                                    <label>Target:</label>
                                    <input type="text" id="blereplayTarget" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-warning" onclick="runBleReplay()">&#9654;&#9654; REPLAY</button>
                                </div>
                                <div class="tool-output hidden" id="blereplayOutput"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== INJECTION ==================== -->
                    <div id="cyberInject" class="cyber-category">
                        <div class="cyber-category-header">
                            <h3>&#9000; HID Injection & Ducky</h3>
                            <p>Keystroke injection, BadUSB-style attacks over Bluetooth</p>
                        </div>

                        <!-- HID Injection (existing tool, enhanced) -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#9000;</span>
                                    <span class="tool-name">HID Injection</span>
                                    <span class="tool-badge critical">CVE-2023-45866</span>
                                </div>
                                <div class="tool-status" id="hidToolInstalled">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Inject keystrokes into vulnerable Bluetooth devices. Exploits unauthenticated HID pairing.</p>
                                <div class="cyber-tool-status" id="hidToolStatus">
                                    <div class="status-row">
                                        <span class="status-label">Adapter:</span>
                                        <span class="status-value" id="hidAdapterStatus">--</span>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <label>Target Platform:</label>
                                    <select id="hidTargetPlatform" class="input">
                                        <option value="android">Android</option>
                                        <option value="linux">Linux</option>
                                        <option value="macos">macOS</option>
                                        <option value="ios">iOS</option>
                                        <option value="windows">Windows</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label>Target Device:</label>
                                    <div class="input-with-btn">
                                        <input type="text" id="hidTargetAddress" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                        <button class="btn btn-sm" onclick="fillFromSurvey('hidTargetAddress')">&#8592;</button>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <label>Payload:</label>
                                    <select id="hidPayloadType" class="input" onchange="updateHidPayloadPreview()">
                                        <option value="custom">Custom Keystrokes</option>
                                        <option value="hello">Hello World Test</option>
                                        <option value="revshell_linux">Reverse Shell (Linux)</option>
                                        <option value="revshell_macos">Reverse Shell (macOS)</option>
                                        <option value="download_exec">Download & Execute</option>
                                        <option value="rickroll">Rickroll (Open YouTube)</option>
                                    </select>
                                </div>
                                <div class="form-row" id="hidCustomPayloadRow">
                                    <textarea id="hidPayloadText" class="input textarea" rows="4" placeholder="Enter keystrokes to inject..."></textarea>
                                </div>
                                <div class="form-row hidden" id="hidRevshellOptions">
                                    <label>LHOST:</label>
                                    <input type="text" id="hidLhost" class="input" placeholder="192.168.1.100">
                                    <label class="ml-10">LPORT:</label>
                                    <input type="text" id="hidLport" class="input" placeholder="4444" style="width: 80px;">
                                </div>
                                <div class="form-row hidden" id="hidDownloadOptions">
                                    <label>URL:</label>
                                    <input type="text" id="hidDownloadUrl" class="input" placeholder="http://192.168.1.100/payload.sh">
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-success" id="btnHidInject" onclick="startHidInjection()">&#9889; INJECT</button>
                                    <button class="btn btn-danger" id="btnHidStop" onclick="stopHidInjection()" disabled>&#9632; STOP</button>
                                    <button class="btn btn-secondary" onclick="setupHidTool()">&#128295; SETUP</button>
                                </div>
                                <div class="tool-output hidden" id="hidResults">
                                    <div class="tool-output-content" id="hidResultsLog"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Uberducky -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#129414;</span>
                                    <span class="tool-name">Uberducky</span>
                                    <span class="tool-badge">Ubertooth HID</span>
                                </div>
                                <div class="tool-status" id="uberducky Status">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Use Ubertooth as a Rubber Ducky. Inject keystrokes using Ubertooth hardware.</p>
                                <div class="form-row">
                                    <label>Target:</label>
                                    <input type="text" id="uberducky Target" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                </div>
                                <div class="form-row">
                                    <label>Ducky Script:</label>
                                    <textarea id="uberducky Script" class="input textarea" rows="6" placeholder="REM Uberducky Script&#10;DELAY 1000&#10;STRING Hello World!&#10;ENTER"></textarea>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-warning" onclick="runUberducky()">&#129414; INJECT</button>
                                    <button class="btn btn-secondary" onclick="installTool('uberducky')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="uberducky Output"></div>
                            </div>
                        </div>

                        <!-- Link Key Extraction -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128273;</span>
                                    <span class="tool-name">Link Key Extraction</span>
                                    <span class="tool-badge">Key Theft</span>
                                </div>
                                <div class="tool-status" id="linkKeyStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Extract Bluetooth link keys from paired devices for impersonation attacks.</p>
                                <div class="form-row">
                                    <label>Method:</label>
                                    <select id="linkKeyMethod" class="input">
                                        <option value="bluetooth">Bluetooth (Magic Keyboard)</option>
                                        <option value="lightning">Lightning Port (iOS)</option>
                                        <option value="usb_spoof">USB Spoofing</option>
                                        <option value="filesystem">Filesystem (rooted)</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label>Target:</label>
                                    <input type="text" id="linkKeyTargetAddress" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-warning" onclick="extractLinkKey()">&#128273; EXTRACT KEY</button>
                                </div>
                                <div class="tool-output hidden" id="linkKeyResults">
                                    <div class="tool-output-content" id="linkKeyResultsContent"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== FIRMWARE ==================== -->
                    <div id="cyberFirmware" class="cyber-category">
                        <div class="cyber-category-header">
                            <h3>&#128187; Firmware Analysis</h3>
                            <p>Bluetooth chip firmware debugging, patching, and analysis</p>
                        </div>

                        <!-- InternalBlue -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128187;</span>
                                    <span class="tool-name">InternalBlue</span>
                                    <span class="tool-badge">Broadcom/Cypress</span>
                                </div>
                                <div class="tool-status" id="internalblueStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Bluetooth experimentation framework for Broadcom/Cypress chips. Patch firmware, dump memory, inject packets.</p>
                                <div class="tool-requirements">
                                    <span class="req-label">Supported:</span> Nexus, Raspberry Pi, iPhone, Mac, Samsung, Eval Boards
                                </div>
                                <div class="form-row">
                                    <label>Device:</label>
                                    <select id="internalblueDevice" class="input">
                                        <option value="adb">Android (ADB)</option>
                                        <option value="hci">HCI (Linux)</option>
                                        <option value="ios">iOS (SSH)</option>
                                        <option value="macos">macOS</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label>Action:</label>
                                    <select id="internalblueAction" class="input">
                                        <option value="info">Device Info</option>
                                        <option value="memdump">Memory Dump</option>
                                        <option value="patch">Load Patch</option>
                                        <option value="fuzz">Fuzzing Mode</option>
                                    </select>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-primary" onclick="runInternalblue()">&#128187; RUN</button>
                                    <button class="btn btn-secondary" onclick="installTool('internalblue')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="internalblueOutput"></div>
                            </div>
                        </div>

                        <!-- Frankenstein -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#129302;</span>
                                    <span class="tool-name">Frankenstein</span>
                                    <span class="tool-badge">Emulator</span>
                                </div>
                                <div class="tool-status" id="frankensteinStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Broadcom/Cypress Bluetooth firmware emulator. Fuzz and analyze firmware without hardware.</p>
                                <div class="form-row">
                                    <label>Firmware:</label>
                                    <input type="file" id="frankensteinFirmware" class="input" accept=".bin,.elf">
                                </div>
                                <div class="form-row">
                                    <label>Mode:</label>
                                    <select id="frankensteinMode" class="input">
                                        <option value="emulate">Emulate</option>
                                        <option value="fuzz">Fuzz</option>
                                        <option value="trace">Trace Execution</option>
                                    </select>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-primary" onclick="runFrankenstein()">&#129302; EMULATE</button>
                                    <button class="btn btn-secondary" onclick="installTool('frankenstein')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="frankensteinOutput"></div>
                            </div>
                        </div>

                        <!-- Polypyus -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128300;</span>
                                    <span class="tool-name">Polypyus</span>
                                    <span class="tool-badge">Binary Analysis</span>
                                </div>
                                <div class="tool-status" id="polypyusStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Learn functions from binaries and apply to other Bluetooth firmware for reverse engineering.</p>
                                <div class="form-row">
                                    <label>Reference Binary:</label>
                                    <input type="file" id="polypyusReference" class="input" accept=".bin,.elf">
                                </div>
                                <div class="form-row">
                                    <label>Target Binary:</label>
                                    <input type="file" id="polypyusTarget" class="input" accept=".bin,.elf">
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-primary" onclick="runPolypyus()">&#128300; ANALYZE</button>
                                    <button class="btn btn-secondary" onclick="installTool('polypyus')">&#128229; INSTALL</button>
                                </div>
                                <div class="tool-output hidden" id="polypyusOutput"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== UTILITIES ==================== -->
                    <div id="cyberUtils" class="cyber-category">
                        <div class="cyber-category-header">
                            <h3>&#128295; Utilities</h3>
                            <p>MAC spoofing, beacons, miscellaneous Bluetooth tools</p>
                        </div>

                        <!-- Bluefog -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#127787;</span>
                                    <span class="tool-name">Bluefog</span>
                                    <span class="tool-badge">MAC Spoof</span>
                                </div>
                                <div class="tool-status" id="bluefogStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Flood the area with fake Bluetooth devices. Creates noise and confusion for tracking systems.</p>
                                <div class="form-row">
                                    <label>Number of Devices:</label>
                                    <input type="number" id="bluefogCount" class="input" value="10" min="1" max="100">
                                </div>
                                <div class="form-row">
                                    <label>Device Class:</label>
                                    <select id="bluefogClass" class="input">
                                        <option value="random">Random</option>
                                        <option value="phone">Phone</option>
                                        <option value="computer">Computer</option>
                                        <option value="audio">Audio Device</option>
                                        <option value="peripheral">Peripheral</option>
                                    </select>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-warning" onclick="runBluefog()">&#127787; START FOG</button>
                                    <button class="btn btn-danger" onclick="stopBluefog()" disabled id="btnStopBluefog">&#9632; STOP</button>
                                </div>
                                <div class="tool-output hidden" id="bluefogOutput"></div>
                            </div>
                        </div>

                        <!-- MiniBeacon -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128246;</span>
                                    <span class="tool-name">BLE Beacon</span>
                                    <span class="tool-badge">iBeacon/Eddystone</span>
                                </div>
                                <div class="tool-status" id="beaconStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Create custom BLE beacons. Useful for testing location services and phishing.</p>
                                <div class="form-row">
                                    <label>Beacon Type:</label>
                                    <select id="beaconType" class="input">
                                        <option value="ibeacon">iBeacon (Apple)</option>
                                        <option value="eddystone_uid">Eddystone UID</option>
                                        <option value="eddystone_url">Eddystone URL</option>
                                        <option value="altbeacon">AltBeacon</option>
                                    </select>
                                </div>
                                <div class="form-row" id="beaconUuidRow">
                                    <label>UUID:</label>
                                    <input type="text" id="beaconUuid" class="input" placeholder="E2C56DB5-DFFB-48D2-B060-D0F5A71096E0">
                                </div>
                                <div class="form-row" id="beaconUrlRow" style="display:none;">
                                    <label>URL:</label>
                                    <input type="text" id="beaconUrl" class="input" placeholder="https://example.com">
                                </div>
                                <div class="form-row">
                                    <label>TX Power:</label>
                                    <select id="beaconTxPower" class="input">
                                        <option value="high">High</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="low">Low</option>
                                    </select>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-success" onclick="startBeacon()">&#128246; BROADCAST</button>
                                    <button class="btn btn-danger" onclick="stopBeacon()" disabled id="btnStopBeacon">&#9632; STOP</button>
                                </div>
                            </div>
                        </div>

                        <!-- Bluepot Honeypot -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#127855;</span>
                                    <span class="tool-name">Bluepot</span>
                                    <span class="tool-badge">Honeypot</span>
                                </div>
                                <div class="tool-status" id="bluepotStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Bluetooth honeypot. Emulate vulnerable services to detect and log attack attempts.</p>
                                <div class="tool-options">
                                    <label class="toggle">
                                        <input type="checkbox" id="bluepotSdp" checked>
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">Emulate SDP</span>
                                    </label>
                                    <label class="toggle">
                                        <input type="checkbox" id="bluepotObex" checked>
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">Emulate OBEX</span>
                                    </label>
                                    <label class="toggle">
                                        <input type="checkbox" id="bluepotHid">
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">Emulate HID</span>
                                    </label>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-success" onclick="startBluepot()">&#127855; START HONEYPOT</button>
                                    <button class="btn btn-danger" onclick="stopBluepot()" disabled id="btnStopBluepot">&#9632; STOP</button>
                                </div>
                                <div class="tool-output hidden" id="bluepotOutput"></div>
                            </div>
                        </div>

                        <!-- Bdaddr Changer -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128260;</span>
                                    <span class="tool-name">BD Address Changer</span>
                                    <span class="tool-badge">MAC Spoof</span>
                                </div>
                                <div class="tool-status" id="bdaddrStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Change your Bluetooth adapter's BD address for anonymity or impersonation.</p>
                                <div class="form-row">
                                    <label>Interface:</label>
                                    <select id="bdaddrInterface" class="input">
                                        <option value="hci0">hci0</option>
                                        <option value="hci1">hci1</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label>New Address:</label>
                                    <div class="input-with-btn">
                                        <input type="text" id="bdaddrNew" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                        <button class="btn btn-sm" onclick="generateRandomBdaddr()">&#127922; Random</button>
                                    </div>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-warning" onclick="changeBdaddr()">&#128260; CHANGE</button>
                                    <button class="btn btn-secondary" onclick="resetBdaddr()">&#8634; RESET</button>
                                </div>
                                <div class="tool-output hidden" id="bdaddrOutput"></div>
                            </div>
                        </div>

                        <!-- L2ping Flood -->
                        <div class="cyber-tool-card">
                            <div class="tool-card-header" onclick="toggleToolCard(this)">
                                <div class="tool-info">
                                    <span class="tool-icon">&#128165;</span>
                                    <span class="tool-name">L2ping Stress</span>
                                    <span class="tool-badge">DoS Testing</span>
                                </div>
                                <div class="tool-status" id="l2pingStatus">--</div>
                                <span class="tool-expand">&#9660;</span>
                            </div>
                            <div class="tool-card-body">
                                <p class="tool-desc">Bluetooth stress testing with L2CAP ping. Test device stability under load.</p>
                                <div class="form-row">
                                    <label>Target:</label>
                                    <div class="input-with-btn">
                                        <input type="text" id="l2pingTarget" class="input" placeholder="XX:XX:XX:XX:XX:XX">
                                        <button class="btn btn-sm" onclick="fillFromSurvey('l2pingTarget')">&#8592;</button>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <label>Packet Size:</label>
                                    <select id="l2pingSize" class="input">
                                        <option value="44">44 bytes (default)</option>
                                        <option value="600">600 bytes</option>
                                        <option value="1024">1024 bytes</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label>Count:</label>
                                    <input type="number" id="l2pingCount" class="input" value="100" min="1" max="10000">
                                </div>
                                <div class="cyber-warning">
                                    <span class="warning-icon">&#9888;</span>
                                    <span>DoS testing requires explicit authorization.</span>
                                </div>
                                <div class="tool-actions">
                                    <button class="btn btn-danger" onclick="runL2pingFlood()">&#128165; FLOOD</button>
                                    <button class="btn btn-danger" onclick="stopL2ping()" disabled id="btnStopL2ping">&#9632; STOP</button>
                                </div>
                                <div class="tool-output hidden" id="l2pingOutput"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Authorization Warning -->
                    <div class="cyber-auth-warning">
                        <span class="warning-icon">&#9888;</span>
                        <strong>AUTHORIZED USE ONLY</strong>
                        <p>These tools are for authorized security testing, penetration testing, and research only. Ensure you have proper written authorization before using any offensive tools. Unauthorized access to computer systems is illegal.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Targets Modal -->
    <div id="targetsModal" class="modal hidden">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <span>&#127919; TARGET MANAGEMENT</span>
                <button class="modal-close" onclick="closeTargetsModal()">&times;</button>
            </div>
            <div class="modal-body targets-body">
                <!-- Add Target Form -->
                <div class="targets-add-section">
                    <h3>Add New Target</h3>
                    <div class="targets-add-form">
                        <div class="input-row">
                            <input type="text" id="modalTargetBdAddress" class="input" placeholder="BD Address (XX:XX:XX:XX:XX:XX)">
                        </div>
                        <div class="input-row">
                            <input type="text" id="modalTargetAlias" class="input" placeholder="Alias (optional)">
                        </div>
                        <button class="btn btn-primary" onclick="addTargetFromModal()">
                            &#10010; ADD TARGET
                        </button>
                    </div>
                </div>

                <!-- Target List -->
                <div class="targets-list-section">
                    <div class="targets-list-header">
                        <h3>Active Targets (<span id="modalTargetCount">0</span>)</h3>
                        <div class="targets-actions">
                            <button class="btn btn-sm btn-secondary" onclick="syncTargetsWithPeers()" title="Sync with peers">
                                &#8644; SYNC
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="clearAllTargets()" title="Remove all targets">
                                &#128465; CLEAR
                            </button>
                        </div>
                    </div>
                    <div class="targets-list-container" id="modalTargetList">
                        <!-- Targets populated by JS -->
                        <div class="targets-empty">No targets configured</div>
                    </div>
                </div>

                <!-- Import/Export -->
                <div class="targets-io-section">
                    <h3>Import / Export</h3>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="exportTargets()">
                            &#128190; Export
                        </button>
                        <label class="btn btn-secondary">
                            &#128194; Import
                            <input type="file" id="importTargetsFile" accept=".json,.csv,.txt" onchange="importTargets(event)" hidden>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Piconet Analysis Modal -->
    <div id="piconetModal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <span>&#128279; PICONET ANALYSIS</span>
                <button class="modal-close" onclick="closePiconetModal()">&times;</button>
            </div>
            <div class="modal-body piconet-body">
                <div class="piconet-controls">
                    <button class="btn btn-sm" onclick="refreshPiconetGraph()">&#8635; Refresh</button>
                    <span class="piconet-stats">
                        <span id="piconetNodeCount">0</span> devices |
                        <span id="piconetEdgeCount">0</span> relationships
                    </span>
                </div>
                <div class="piconet-legend">
                    <span class="legend-item"><span class="legend-dot master"></span>Master</span>
                    <span class="legend-item"><span class="legend-dot slave"></span>Slave</span>
                    <span class="legend-item"><span class="legend-dot dual"></span>Dual</span>
                    <span class="legend-item"><span class="legend-dot target"></span>Target</span>
                    <span class="legend-line piconet-line"></span><span>Piconet</span>
                    <span class="legend-line paired-line"></span><span>Paired</span>
                    <span class="legend-line associated-line"></span><span>Associated</span>
                </div>
                <div id="piconetGraphContainer" class="piconet-graph-container">
                    <svg id="piconetGraph"></svg>
                </div>
                <div id="piconetTooltip" class="piconet-tooltip hidden"></div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <span>&#9881; SYSTEM SETTINGS</span>
                <button class="modal-close" onclick="closeSettingsModal()">&times;</button>
            </div>
            <div class="modal-body settings-body">
                <!-- Settings Tabs -->
                <div class="settings-tabs">
                    <button class="settings-tab active" onclick="showSettingsTab('general')">General</button>
                    <button class="settings-tab" onclick="showSettingsTab('gps')">GPS</button>
                    <button class="settings-tab" onclick="showSettingsTab('sms')">SMS</button>
                    <button class="settings-tab" onclick="showSettingsTab('radios')">Radios</button>
                    <button class="settings-tab" onclick="showSettingsTab('network')">Network</button>
                    <button class="settings-tab" onclick="showSettingsTab('users')">Users</button>
                    <button class="settings-tab" onclick="showSettingsTab('ui')">UI Layout</button>
                    <button class="settings-tab" onclick="showSettingsTab('system')">System</button>
                </div>

                <!-- General Settings Tab -->
                <div id="settingsGeneral" class="settings-content active">
                    <div class="settings-group">
                        <h3>System Identification</h3>
                        <div class="form-row">
                            <label>System ID:</label>
                            <input type="text" id="settingSystemId" placeholder="BK9-001">
                        </div>
                        <div class="form-row">
                            <label>System Name:</label>
                            <input type="text" id="settingSystemName" placeholder="BlueK9 Unit 1">
                        </div>
                    </div>
                    <div class="settings-group">
                        <h3>Scan Settings</h3>
                        <div class="form-row">
                            <label>Scan Interval (sec):</label>
                            <input type="number" id="settingScanInterval" min="1" max="60" value="2">
                        </div>
                    </div>
                    <div class="settings-group">
                        <h3>Alert Settings</h3>
                        <div class="form-row">
                            <label>SMS Alert Interval (sec):</label>
                            <input type="number" id="settingSmsInterval" min="30" max="600" value="60">
                        </div>
                    </div>
                    <div class="settings-group">
                        <h3>Display Settings</h3>
                        <div class="form-row">
                            <label>Timezone:</label>
                            <select id="settingTimezone">
                                <option value="UTC">UTC</option>
                                <option value="America/New_York">Eastern (ET)</option>
                                <option value="America/Chicago">Central (CT)</option>
                                <option value="America/Denver">Mountain (MT)</option>
                                <option value="America/Los_Angeles">Pacific (PT)</option>
                                <option value="America/Anchorage">Alaska (AKT)</option>
                                <option value="Pacific/Honolulu">Hawaii (HST)</option>
                                <option value="Europe/London">London (GMT/BST)</option>
                                <option value="Europe/Paris">Central Europe (CET)</option>
                                <option value="Europe/Berlin">Berlin (CET)</option>
                                <option value="Asia/Tokyo">Tokyo (JST)</option>
                                <option value="Asia/Shanghai">China (CST)</option>
                                <option value="Asia/Dubai">Dubai (GST)</option>
                                <option value="Australia/Sydney">Sydney (AEST)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- GPS Settings Tab -->
                <div id="settingsGps" class="settings-content">
                    <div class="settings-group">
                        <h3>GPS Source</h3>
                        <div class="form-row">
                            <label>Source Type:</label>
                            <select id="settingGpsSource" onchange="updateGpsSettingsFields()">
                                <option value="nmea_tcp">NMEA TCP</option>
                                <option value="gpsd">GPSD</option>
                                <option value="serial">Serial</option>
                            </select>
                        </div>
                        <div id="gpsNmeaSettings">
                            <div class="form-row">
                                <label>NMEA Host:</label>
                                <input type="text" id="settingNmeaHost" placeholder="127.0.0.1">
                            </div>
                            <div class="form-row">
                                <label>NMEA Port:</label>
                                <input type="number" id="settingNmeaPort" value="10110">
                            </div>
                        </div>
                        <div id="gpsGpsdSettings" class="hidden">
                            <div class="form-row">
                                <label>GPSD Host:</label>
                                <input type="text" id="settingGpsdHost" placeholder="127.0.0.1">
                            </div>
                            <div class="form-row">
                                <label>GPSD Port:</label>
                                <input type="number" id="settingGpsdPort" value="2947">
                            </div>
                        </div>
                        <div id="gpsSerialSettings" class="hidden">
                            <div class="form-row">
                                <label>Serial Port:</label>
                                <input type="text" id="settingSerialPort" placeholder="/dev/ttyUSB0">
                            </div>
                            <div class="form-row">
                                <label>Baud Rate:</label>
                                <select id="settingSerialBaud">
                                    <option value="4800">4800</option>
                                    <option value="9600" selected>9600</option>
                                    <option value="38400">38400</option>
                                    <option value="115200">115200</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="testGpsSettings()">Test Connection</button>
                    </div>
                </div>

                <!-- SMS Settings Tab -->
                <div id="settingsSms" class="settings-content">
                    <div class="settings-group">
                        <h3>SMS Alert Numbers</h3>
                        <p class="settings-hint">Add phone numbers to receive target alerts via SMS. Requires SIMCOM7600 modem.</p>
                        <div class="form-row">
                            <input type="tel" id="settingSmsNumber" class="input" placeholder="+1 555 123 4567" style="flex: 1;">
                            <button class="btn btn-primary btn-sm" onclick="addSmsNumberFromSettings()">Add</button>
                        </div>
                        <div class="sms-list-settings" id="smsListSettings">
                            <!-- SMS numbers will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Radios Settings Tab -->
                <div id="settingsRadios" class="settings-content">
                    <div class="settings-group">
                        <h3>Radio Management</h3>
                        <p class="settings-hint">Manage Bluetooth and WiFi adapters.</p>
                        <div class="radio-list-settings" id="radioListSettings">
                            <!-- Radios will be populated here -->
                        </div>
                        <button class="btn btn-secondary mt-10" onclick="refreshRadiosInSettings()">Refresh Radios</button>
                    </div>

                    <div class="settings-group">
                        <h3>Ubertooth Piconet Scanner</h3>
                        <p class="settings-hint">Passive Bluetooth piconet detection using Ubertooth hardware.</p>
                        <div id="ubertoothStatus" class="ubertooth-status">
                            <div class="status-indicator">
                                <span class="status-label">Status:</span>
                                <span id="ubertoothStatusText" class="status-value">Checking...</span>
                            </div>
                            <div class="status-indicator">
                                <span class="status-label">Piconets Detected:</span>
                                <span id="ubertoothPiconetCount" class="status-value">0</span>
                            </div>
                        </div>
                        <div class="ubertooth-controls">
                            <button id="ubertoothStartBtn" class="btn btn-success" onclick="startUbertooth()">Start Scanner</button>
                            <button id="ubertoothStopBtn" class="btn btn-danger" onclick="stopUbertooth()" disabled>Stop Scanner</button>
                            <button class="btn btn-secondary" onclick="refreshUbertoothData()">Refresh Data</button>
                            <button class="btn btn-warning" onclick="clearUbertoothData()">Clear Data</button>
                        </div>
                        <div id="ubertoothDataContainer" class="ubertooth-data">
                            <table class="ubertooth-table">
                                <thead>
                                    <tr>
                                        <th>LAP</th>
                                        <th>UAP</th>
                                        <th>BD Partial</th>
                                        <th>Channels</th>
                                        <th>Packets</th>
                                        <th>First Seen</th>
                                        <th>Last Seen</th>
                                    </tr>
                                </thead>
                                <tbody id="ubertoothDataTable">
                                    <!-- Piconet data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- HackRF SDR Spectrum Analyzer -->
                    <div class="settings-group">
                        <h3>HackRF SDR Spectrum Analyzer</h3>
                        <p class="settings-hint">Software-defined radio for Bluetooth spectrum analysis, piconet detection, and frequency hopping pattern identification.</p>

                        <div id="hackrfStatus" class="hackrf-status">
                            <div class="status-row">
                                <div class="status-indicator">
                                    <span class="status-label">Status:</span>
                                    <span id="hackrfStatusText" class="status-value">Checking...</span>
                                </div>
                                <div class="status-indicator">
                                    <span class="status-label">Firmware:</span>
                                    <span id="hackrfFirmware" class="status-value">--</span>
                                </div>
                            </div>
                            <div class="status-row">
                                <div class="status-indicator">
                                    <span class="status-label">Active Channels:</span>
                                    <span id="hackrfActiveChannels" class="status-value">0/79</span>
                                </div>
                                <div class="status-indicator">
                                    <span class="status-label">Hop Patterns:</span>
                                    <span id="hackrfHopPatterns" class="status-value">0</span>
                                </div>
                            </div>
                            <div class="status-row">
                                <div class="status-indicator">
                                    <span class="status-label">Peak Power:</span>
                                    <span id="hackrfPeakPower" class="status-value">-- dBm</span>
                                </div>
                                <div class="status-indicator">
                                    <span class="status-label">Utilization:</span>
                                    <span id="hackrfUtilization" class="status-value">0%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Spectrum Display -->
                        <div class="hackrf-spectrum-container">
                            <div class="spectrum-header">
                                <span class="spectrum-title">2.4 GHz Bluetooth Band (2402-2480 MHz)</span>
                                <div class="spectrum-legend">
                                    <span class="legend-item"><span class="legend-color active"></span> Active</span>
                                    <span class="legend-item"><span class="legend-color inactive"></span> Inactive</span>
                                    <span class="legend-item"><span class="legend-color hopping"></span> Hopping</span>
                                </div>
                            </div>
                            <div class="hackrf-spectrum-display" id="hackrfSpectrumDisplay">
                                <canvas id="hackrfSpectrumCanvas" width="800" height="200"></canvas>
                            </div>
                            <div class="spectrum-axis">
                                <span>Ch 0 (2402)</span>
                                <span>Ch 39 (2441)</span>
                                <span>Ch 78 (2480)</span>
                            </div>
                        </div>

                        <!-- Waterfall Display -->
                        <div class="hackrf-waterfall-container">
                            <div class="waterfall-header">
                                <span class="waterfall-title">Waterfall Display</span>
                                <div class="waterfall-controls">
                                    <button class="btn btn-sm btn-secondary" onclick="toggleWaterfall()">Toggle</button>
                                </div>
                            </div>
                            <div class="hackrf-waterfall-display hidden" id="hackrfWaterfallDisplay">
                                <canvas id="hackrfWaterfallCanvas" width="800" height="150"></canvas>
                            </div>
                        </div>

                        <!-- Channel Activity Grid -->
                        <div class="hackrf-channel-grid-container">
                            <div class="channel-grid-header">
                                <span class="channel-grid-title">Bluetooth Channel Activity (79 channels)</span>
                            </div>
                            <div class="hackrf-channel-grid" id="hackrfChannelGrid">
                                <!-- 79 channel indicators will be generated by JS -->
                            </div>
                        </div>

                        <!-- Configuration -->
                        <div class="hackrf-config">
                            <h4>SDR Configuration</h4>
                            <div class="config-grid">
                                <div class="config-item">
                                    <label>LNA Gain (0-40 dB):</label>
                                    <input type="range" id="hackrfLnaGain" min="0" max="40" value="32" class="slider">
                                    <span id="hackrfLnaGainValue">32 dB</span>
                                </div>
                                <div class="config-item">
                                    <label>VGA Gain (0-62 dB):</label>
                                    <input type="range" id="hackrfVgaGain" min="0" max="62" value="20" class="slider">
                                    <span id="hackrfVgaGainValue">20 dB</span>
                                </div>
                                <div class="config-item">
                                    <label>Activity Threshold:</label>
                                    <input type="range" id="hackrfThreshold" min="-100" max="-30" value="-60" class="slider">
                                    <span id="hackrfThresholdValue">-60 dBm</span>
                                </div>
                            </div>
                        </div>

                        <!-- Controls -->
                        <div class="hackrf-controls">
                            <button id="hackrfStartBtn" class="btn btn-success" onclick="startHackrf()">
                                <span class="btn-icon">&#9654;</span> Start Spectrum Sweep
                            </button>
                            <button id="hackrfStopBtn" class="btn btn-danger" onclick="stopHackrf()" disabled>
                                <span class="btn-icon">&#9632;</span> Stop
                            </button>
                            <button class="btn btn-secondary" onclick="refreshHackrfData()">
                                <span class="btn-icon">&#8635;</span> Refresh
                            </button>
                            <button class="btn btn-warning" onclick="clearHackrfData()">
                                <span class="btn-icon">&#128465;</span> Clear
                            </button>
                            <button class="btn btn-primary" onclick="exportHackrfData()">
                                <span class="btn-icon">&#128190;</span> Export
                            </button>
                        </div>

                        <!-- Detected Piconets/Patterns Table -->
                        <div id="hackrfPiconetsContainer" class="hackrf-piconets">
                            <h4>Detected Frequency Hopping Patterns</h4>
                            <table class="hackrf-table">
                                <thead>
                                    <tr>
                                        <th>Pattern ID</th>
                                        <th>Channels</th>
                                        <th>Avg Power</th>
                                        <th>BT-like</th>
                                        <th>Correlated LAP</th>
                                        <th>Detected</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="hackrfPiconetsTable">
                                    <!-- Pattern data will be populated here -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Fusion Intelligence -->
                        <div id="hackrfFusionContainer" class="hackrf-fusion">
                            <h4>Sensor Fusion Intelligence</h4>
                            <p class="fusion-hint">Combined analysis from HackRF + Ubertooth + Bluetooth adapters</p>
                            <div class="fusion-stats">
                                <div class="fusion-stat">
                                    <span class="stat-label">Sources Active:</span>
                                    <span id="fusionSourcesActive" class="stat-value">0/3</span>
                                </div>
                                <div class="fusion-stat">
                                    <span class="stat-label">Correlated Devices:</span>
                                    <span id="fusionCorrelatedDevices" class="stat-value">0</span>
                                </div>
                            </div>
                            <div id="fusionRecommendations" class="fusion-recommendations">
                                <!-- Recommendations will be populated here -->
                            </div>
                            <button class="btn btn-secondary mt-10" onclick="loadFusionData()">
                                <span class="btn-icon">&#128301;</span> Analyze Fusion Data
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Network Settings Tab -->
                <div id="settingsNetwork" class="settings-content">
                    <div class="settings-group">
                        <h3>WARHAMMER Network Status</h3>
                        <p class="settings-hint">Mesh network connectivity for BlueK9 systems.</p>
                        <div class="network-info-grid">
                            <div class="info-row">
                                <span class="info-label">Network:</span>
                                <span class="info-value" id="settingsNetworkName">WARHAMMER</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value" id="settingsNetworkStatus">--</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Connected Peers:</span>
                                <span class="info-value" id="settingsNetworkPeers">--</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">BlueK9 Nodes:</span>
                                <span class="info-value" id="settingsNetworkBk9">--</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Active Routes:</span>
                                <span class="info-value" id="settingsNetworkRoutes">--</span>
                            </div>
                        </div>
                        <div class="btn-group mt-10">
                            <button class="btn btn-secondary" onclick="refreshNetworkSettings()">Refresh Status</button>
                        </div>
                    </div>

                    <!-- Speed Test -->
                    <div class="settings-group">
                        <h3>Network Speed Test</h3>
                        <p class="settings-hint">Test throughput to peer nodes via iperf3.</p>
                        <div class="settings-speedtest">
                            <div class="speedtest-controls">
                                <select class="input" id="settingsSpeedtestPeer">
                                    <option value="">Select target node...</option>
                                </select>
                                <button class="btn btn-primary" id="settingsSpeedtestStart" onclick="startSpeedTestFromSettings()">
                                     TEST
                                </button>
                                <button class="btn btn-danger hidden" id="settingsSpeedtestStop" onclick="stopSpeedTest()">
                                     STOP
                                </button>
                            </div>
                            <div class="speedtest-live hidden" id="settingsSpeedtestLive">
                                <div class="speedtest-progress-container">
                                    <div class="speedtest-progress-bar" id="settingsSpeedtestProgress"></div>
                                    <span class="speedtest-progress-text" id="settingsSpeedtestPercent">0%</span>
                                </div>
                                <div class="speedtest-live-speed">
                                    <span class="speedtest-speed-value" id="settingsSpeedtestSpeed">0.00</span>
                                    <span class="speedtest-speed-unit">Mbps</span>
                                </div>
                                <div class="speedtest-graph-container">
                                    <canvas id="settingsSpeedtestChart" height="100"></canvas>
                                </div>
                            </div>
                            <div class="speedtest-results hidden" id="settingsSpeedtestResults">
                                <div class="speedtest-results-grid">
                                    <div class="speedtest-result-item">
                                        <span class="speedtest-result-icon upload"></span>
                                        <span class="speedtest-result-value" id="settingsResultUpload">--</span>
                                        <span class="speedtest-result-label">UPLOAD</span>
                                    </div>
                                    <div class="speedtest-result-item">
                                        <span class="speedtest-result-icon download"></span>
                                        <span class="speedtest-result-value" id="settingsResultDownload">--</span>
                                        <span class="speedtest-result-label">DOWNLOAD</span>
                                    </div>
                                    <div class="speedtest-result-item">
                                        <span class="speedtest-result-icon retransmit"></span>
                                        <span class="speedtest-result-value" id="settingsResultRetransmits">--</span>
                                        <span class="speedtest-result-label">RETRANSMITS</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Connected Peers -->
                    <div class="settings-group">
                        <h3>Connected Peers</h3>
                        <p class="settings-hint">View all network peers and their status.</p>
                        <div class="settings-peer-filter">
                            <button class="peer-filter-btn active" id="settingsFilterAll" onclick="setSettingsPeerFilter('all')">ALL</button>
                            <button class="peer-filter-btn" id="settingsFilterBk9" onclick="setSettingsPeerFilter('bluek9')">BK9 ONLY</button>
                        </div>
                        <div class="settings-peer-list" id="settingsPeerList">
                            <!-- Peers populated by JS -->
                        </div>
                    </div>

                    <!-- Peer Settings -->
                    <div class="settings-group">
                        <h3>Peer Settings</h3>
                        <p class="settings-hint">Configure peer communication options.</p>
                        <div class="toggle-group">
                            <label class="toggle">
                                <input type="checkbox" id="settingsShareLocation" checked>
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Share Location with Peers</span>
                            </label>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle">
                                <input type="checkbox" id="settingsAutoConnect" checked>
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Auto-connect on Startup</span>
                            </label>
                        </div>
                    </div>

                    <!-- Route Management -->
                    <div class="settings-group">
                        <h3>Route Management</h3>
                        <p class="settings-hint">Manage network routes. Routes marked as "persistent" cannot be modified.</p>
                        <div class="routes-settings-list" id="routesSettingsList">
                            <!-- Routes populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Users Tab -->
                <div id="settingsUsers" class="settings-content">
                    <div class="settings-group">
                        <h3>User Management</h3>
                        <div id="userList" class="user-list">
                            <!-- Users will be populated here -->
                        </div>
                        <div id="addUserForm" class="add-user-form {{ 'hidden' if not is_admin else '' }}">
                            <h4>Add New User</h4>
                            <div class="form-row">
                                <label>Username:</label>
                                <input type="text" id="newUsername" placeholder="username">
                            </div>
                            <div class="form-row">
                                <label>Password:</label>
                                <input type="password" id="newPassword" placeholder="password">
                            </div>
                            <div class="form-row">
                                <label>Admin:</label>
                                <input type="checkbox" id="newUserAdmin">
                            </div>
                            <button class="btn btn-success" onclick="createUser()">Create User</button>
                        </div>
                    </div>
                    <div class="settings-group">
                        <h3>Change Your Password</h3>
                        <div class="form-row">
                            <label>Current Password:</label>
                            <input type="password" id="currentPassword">
                        </div>
                        <div class="form-row">
                            <label>New Password:</label>
                            <input type="password" id="newPasswordChange">
                        </div>
                        <div class="form-row">
                            <label>Confirm Password:</label>
                            <input type="password" id="confirmPassword">
                        </div>
                        <button class="btn btn-primary" onclick="changePassword()">Change Password</button>
                    </div>
                </div>

                <!-- UI Layout Tab -->
                <div id="settingsUi" class="settings-content">
                    <div class="settings-group">
                        <h3>Panel Layout</h3>
                        <p class="settings-hint">Drag panel edges to resize. Your layout is saved automatically.</p>
                        <div class="form-row">
                            <label>Left Panel Width:</label>
                            <input type="number" id="settingLeftPanelWidth" min="200" max="500" value="280">
                            <span>px</span>
                        </div>
                        <div class="form-row">
                            <label>Right Panel Width:</label>
                            <input type="number" id="settingRightPanelWidth" min="300" max="600" value="420">
                            <span>px</span>
                        </div>
                    </div>
                    <div class="settings-group">
                        <h3>Export/Import Configuration</h3>
                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="exportConfig()">Export Config</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('importConfigFile').click()">Import Config</button>
                            <input type="file" id="importConfigFile" accept=".json" style="display:none" onchange="importConfig(event)">
                        </div>
                    </div>
                    <div class="settings-group">
                        <h3>Reset Layout</h3>
                        <button class="btn btn-danger" onclick="resetLayout()">Reset to Default</button>
                    </div>
                </div>

                <!-- System Tab -->
                <div id="settingsSystem" class="settings-content">
                    <div class="settings-group">
                        <h3>Software Updates</h3>
                        <p class="settings-hint">Check for and install updates from GitHub repository.</p>
                        <div class="update-check-container">
                            <button class="btn btn-primary" id="btnCheckUpdates" onclick="checkForUpdates()">
                                <span class="btn-icon">&#8635;</span> CHECK FOR UPDATES
                            </button>
                        </div>
                        <div class="update-status-panel hidden" id="updateStatusPanel">
                            <div class="update-status-header">
                                <span class="update-status-icon" id="updateStatusIcon">&#128268;</span>
                                <span class="update-status-text" id="updateStatusText">Checking...</span>
                            </div>
                            <div class="update-details" id="updateDetails">
                                <!-- Update details populated by JS -->
                            </div>
                            <div class="update-changes hidden" id="updateChangesSection">
                                <div class="changes-header">Recent Changes:</div>
                                <div class="changes-list" id="updateChangesList">
                                    <!-- Changes populated by JS -->
                                </div>
                            </div>
                            <div class="update-actions hidden" id="updateActions">
                                <button class="btn btn-success" id="btnApplyUpdate" onclick="applyUpdates()">
                                    <span class="btn-icon">&#10003;</span> APPLY UPDATE
                                </button>
                                <p class="update-warning">System will restart after update</p>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <h3>System Information</h3>
                        <div class="system-info-grid">
                            <div class="sysinfo-row">
                                <span class="sysinfo-label">Current Version:</span>
                                <span class="sysinfo-value" id="sysInfoVersion">--</span>
                            </div>
                            <div class="sysinfo-row">
                                <span class="sysinfo-label">Current Commit:</span>
                                <span class="sysinfo-value sysinfo-commit" id="sysInfoCommit">--</span>
                            </div>
                            <div class="sysinfo-row">
                                <span class="sysinfo-label">Branch:</span>
                                <span class="sysinfo-value" id="sysInfoBranch">--</span>
                            </div>
                            <div class="sysinfo-row">
                                <span class="sysinfo-label">Last Updated:</span>
                                <span class="sysinfo-value" id="sysInfoLastUpdate">--</span>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <h3>Maintenance</h3>
                        <div class="btn-group">
                            <button class="btn btn-warning" onclick="restartSystem()">
                                <span class="btn-icon">&#8634;</span> RESTART SYSTEM
                            </button>
                        </div>
                        <p class="settings-hint" style="margin-top: 10px;">Restart will clear all session data and reinitialize the system.</p>
                    </div>
                </div>

                <!-- Save Button -->
                <div class="settings-footer">
                    <button class="btn btn-primary" onclick="saveAllSettings()">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <img src="{{ url_for('static', filename='logo/logo.png') }}" alt="BlueK9" class="header-logo">
                <span class="logo-text">BLUEK9</span>
                <span class="header-divider">|</span>
                <span class="status-indicator" id="statusIndicator">
                    <span class="status-dot"></span>
                    <span class="status-text">STANDBY</span>
                </span>
                <!-- Activity Indicator - Radar/Pulse Animation -->
                <div class="activity-indicator" id="activityIndicator">
                    <div class="radar-sweep"></div>
                    <div class="radar-ping"></div>
                </div>
            </div>
            <div class="header-center">
                <div class="system-info">
                    <span class="info-label">SYS LOC:</span>
                    <span class="info-value" id="sysLocation">---, ---</span>
                </div>
                <div class="system-info">
                    <span class="info-label">TIME:</span>
                    <span class="info-value" id="sysTime">--:--:--</span>
                </div>
                <div class="system-info">
                    <span class="info-label">DEVICES:</span>
                    <span class="info-value" id="deviceCount">0</span>
                </div>
                <div class="system-info">
                    <span class="info-label">TARGETS:</span>
                    <span class="info-value target-count" id="targetCount">0</span>
                </div>
                <div class="system-info hw-info">
                    <span class="info-label">CPU:</span>
                    <span class="info-value" id="cpuUsage">--%</span>
                </div>
                <div class="system-info hw-info">
                    <span class="info-label">TEMP:</span>
                    <span class="info-value" id="cpuTemp">--C</span>
                </div>
                <div class="system-info hw-info">
                    <span class="info-label">MEM:</span>
                    <span class="info-value" id="memUsage">--%</span>
                </div>
            </div>
            <div class="header-right">
                <!-- Cellular Signal Indicator -->
                <div class="cellular-signal-container" id="cellularSignalContainer" title="Cellular Signal">
                    <div class="cellular-signal-bars" id="cellularSignalBars">
                        <div class="signal-bar" data-bar="1"></div>
                        <div class="signal-bar" data-bar="2"></div>
                        <div class="signal-bar" data-bar="3"></div>
                        <div class="signal-bar" data-bar="4"></div>
                        <div class="signal-bar" data-bar="5"></div>
                    </div>
                    <span class="cellular-tech" id="cellularTech">--</span>
                    <!-- Hover tooltip with detailed info -->
                    <div class="cellular-tooltip" id="cellularTooltip">
                        <div class="tooltip-title">CELLULAR STATUS</div>
                        <div class="tooltip-row">
                            <span class="tooltip-label">Operator:</span>
                            <span class="tooltip-value" id="cellularOperator">--</span>
                        </div>
                        <div class="tooltip-row">
                            <span class="tooltip-label">Technology:</span>
                            <span class="tooltip-value" id="cellularTechnology">--</span>
                        </div>
                        <div class="tooltip-row">
                            <span class="tooltip-label">Signal:</span>
                            <span class="tooltip-value" id="cellularQuality">--%</span>
                        </div>
                        <div class="tooltip-row">
                            <span class="tooltip-label">RSSI:</span>
                            <span class="tooltip-value" id="cellularRssi">-- dBm</span>
                        </div>
                        <div class="tooltip-divider"></div>
                        <div class="tooltip-row">
                            <span class="tooltip-label">Phone:</span>
                            <span class="tooltip-value" id="cellularPhone">--</span>
                        </div>
                        <div class="tooltip-row">
                            <span class="tooltip-label">IMEI:</span>
                            <span class="tooltip-value" id="cellularImei">--</span>
                        </div>
                        <div class="tooltip-row">
                            <span class="tooltip-label">ICCID:</span>
                            <span class="tooltip-value" id="cellularIccid">--</span>
                        </div>
                        <div class="tooltip-row">
                            <span class="tooltip-label">State:</span>
                            <span class="tooltip-value" id="cellularState">--</span>
                        </div>
                    </div>
                </div>
                <button class="targets-btn" onclick="openTargetsModal()" title="Targets">&#127919;</button>
                <button class="tools-btn" onclick="openToolsModal()" title="Tools">&#128295;</button>
                <button class="piconet-btn" onclick="openPiconetModal()" title="Piconet Analysis">&#128279;</button>
                <button class="settings-btn" onclick="openSettingsModal()" title="Settings">&#9881;</button>
                <span class="operator-info">OP: {{ username }}</span>
                <a href="{{ url_for('logout') }}" class="logout-btn">LOGOUT</a>
            </div>
        </header>

        <!-- Operations Bar - Shows running operations -->
        <div class="operations-bar" id="operationsBar">
            <div class="ops-label">ACTIVE OPS:</div>
            <div class="ops-list" id="opsList">
                <span class="ops-none">None</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel - Controls -->
            <aside class="panel panel-left" id="panelLeft" data-dock="left">
                <div class="panel-header" onmousedown="startPanelDrag(event, 'panelLeft')">
                    <span class="panel-header-title">
                        <span>&#9776;</span> CONTROLS
                    </span>
                    <div class="panel-header-controls">
                        <button class="panel-control-btn collapse-btn" onclick="togglePanelCollapse('panelLeft')" title="Collapse">&#8722;</button>
                        <button class="panel-control-btn" onclick="swapPanels()" title="Swap Sides">&#8644;</button>
                    </div>
                </div>
                <!-- Scan Controls -->
                <div class="panel-section" id="sectionScan">
                    <div class="section-header collapsible" onclick="toggleSection('sectionScan')">
                        <span class="section-icon">&#128225;</span>
                        <span>SCAN CONTROL</span>
                        <span class="section-toggle">&#9660;</span>
                    </div>
                    <div class="section-content">
                        <div class="scan-mode-row">
                            <label class="scan-mode-label">MODE:</label>
                            <select class="scan-mode-select" id="scanModeSelect">
                                <option value="quick">QUICK SCAN</option>
                                <option value="target_survey">TARGET SURVEY (PROBE ALL TARGETS)</option>
                                <option value="hidden_hunt">HIDDEN DEVICE HUNT (PHONES/WATCHES)</option>
                                <option value="stimulate_classic">STIMULATE (CLASSIC)</option>
                                <option value="stimulate_ble">STIMULATE (BLE)</option>
                                <option value="aggressive_inquiry">AGGRESSIVE INQUIRY</option>
                                <option value="advanced" selected>ADVANCED (ALL)</option>
                            </select>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-success" id="btnStartScan" onclick="startScan()">
                                <span>&#9654;</span> START
                            </button>
                            <button class="btn btn-danger" id="btnStopScan" onclick="stopScan()" disabled>
                                <span>&#9632;</span> STOP
                            </button>
                        </div>
                        <div class="scan-info-row" id="scanInfoRow" style="display: none;">
                            <span class="scan-info-text" id="scanInfoText"></span>
                        </div>
                    </div>
                </div>

                <!-- Map Controls -->
                <div class="panel-section" id="sectionMap">
                    <div class="section-header collapsible" onclick="toggleSection('sectionMap')">
                        <span class="section-icon">&#127758;</span>
                        <span>MAP CONTROL</span>
                        <span class="section-toggle">&#9660;</span>
                    </div>
                    <div class="section-content">
                        <!-- Layer Selection and Tools -->
                        <div class="map-toolbar">
                            <select class="map-layer-select" id="mapLayerSelect" onchange="setMapStyle(this.value)">
                                <option value="dark">DARK</option>
                                <option value="streets">STREETS</option>
                                <option value="satellite">SATELLITE</option>
                            </select>
                            <button class="btn btn-secondary btn-sm" onclick="recenterOnSystem()" title="Recenter on system location">
                                &#8982; CENTER
                            </button>
                            <button class="btn btn-secondary btn-sm" id="measureBtn" onclick="toggleMeasure()" title="Measure distance">
                                &#128207; MEASURE
                            </button>
                        </div>
                        <div id="measureInfo" class="measure-info hidden">
                            <div class="measure-result">
                                <span class="measure-label">Distance:</span>
                                <span class="measure-value" id="measureDistance">--</span>
                            </div>
                            <div class="measure-result">
                                <span class="measure-label">Bearing:</span>
                                <span class="measure-value" id="measureBearing">--</span>
                            </div>
                            <button class="btn btn-danger btn-sm" onclick="clearMeasure()">CLEAR</button>
                        </div>
                        <!-- Toggles with inline reset buttons -->
                        <div class="toggle-row mt-10">
                            <label class="toggle">
                                <input type="checkbox" id="toggleFollowGps" onchange="toggleFollowGps()">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Follow GPS</span>
                            </label>
                        </div>
                        <div class="toggle-row">
                            <label class="toggle">
                                <input type="checkbox" id="toggleShowCep" checked onchange="toggleShowCep()">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Show CEP</span>
                            </label>
                            <button class="btn-inline-reset" onclick="resetCepCircles()" title="Clear CEP circles">&#8635;</button>
                        </div>
                        <div class="toggle-row">
                            <label class="toggle">
                                <input type="checkbox" id="toggleBreadcrumbs" onchange="toggleBreadcrumbs()">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Target Heatmap</span>
                            </label>
                            <button class="btn-inline-reset" onclick="resetHeatmap()" title="Clear heatmap">&#8635;</button>
                        </div>
                        <div class="toggle-row">
                            <label class="toggle">
                                <input type="checkbox" id="toggleSystemTrail" onchange="toggleSystemTrail()">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">System Trail</span>
                            </label>
                            <button class="btn-inline-reset" onclick="resetSystemTrail()" title="Clear trail">&#8635;</button>
                        </div>
                        <div class="toggle-row">
                            <label class="toggle">
                                <input type="checkbox" id="toggle3dTerrain" onchange="toggle3dTerrain()">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">3D Terrain</span>
                            </label>
                        </div>
                        <div class="toggle-row">
                            <label class="toggle">
                                <input type="checkbox" id="toggle3dBuildings" onchange="toggle3dBuildings()">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">3D Buildings</span>
                            </label>
                        </div>
                        <div class="map-reset-all mt-10">
                            <button class="btn btn-reset btn-sm btn-full" onclick="resetAllGeo()" title="Clear all geo estimates">
                                &#8635; RESET ALL GEO DATA
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Active Geo Tracking -->
                <div class="panel-section" id="sectionTracking">
                    <div class="section-header collapsible" onclick="toggleSection('sectionTracking')">
                        <span class="section-icon">&#128205;</span>
                        <span>TARGET TRACKING</span>
                        <span class="tracking-status" id="trackingStatus">--</span>
                        <span class="section-toggle">&#9660;</span>
                    </div>
                    <div class="section-content">
                        <div class="input-group">
                            <select id="trackTargetSelect" class="input">
                                <option value="">-- Select Target --</option>
                                <!-- Populated by JS -->
                            </select>
                            <button class="btn btn-sm" onclick="refreshTargetList()" title="Refresh">&#8635;</button>
                        </div>
                        <div class="tracking-methods">
                            <label class="method-option">
                                <input type="checkbox" id="methodL2ping" checked>
                                <span>L2PING (RTT)</span>
                            </label>
                            <label class="method-option">
                                <input type="checkbox" id="methodRssi" checked>
                                <span>HCITOOL RSSI</span>
                            </label>
                        </div>
                        <div class="tracking-stats" id="trackingStats">
                            <!-- Stats populated by JS -->
                        </div>
                        <div class="direction-finder hidden" id="directionFinder">
                            <div class="direction-compass">
                                <div class="compass-ring">
                                    <span class="compass-n">N</span>
                                    <span class="compass-e">E</span>
                                    <span class="compass-s">S</span>
                                    <span class="compass-w">W</span>
                                </div>
                                <div class="compass-arrow" id="compassArrow">
                                    <div class="arrow-pointer"></div>
                                </div>
                            </div>
                            <div class="direction-info">
                                <div class="direction-trend" id="directionTrend">--</div>
                                <div class="direction-bearing" id="directionBearing">--</div>
                                <div class="direction-confidence" id="directionConfidence">--</div>
                            </div>
                        </div>
                        <div class="btn-group mt-10">
                            <button class="btn btn-primary" id="btnStartTrack" onclick="startTargetTracking()">START</button>
                            <button class="btn btn-danger" id="btnStopTrack" onclick="stopTargetTracking()" disabled>STOP</button>
                        </div>
                    </div>
                </div>

                <!-- Target Quick View -->
                <div class="panel-section" id="sectionTargets">
                    <div class="section-header collapsible" onclick="toggleSection('sectionTargets')">
                        <span class="section-icon">&#127919;</span>
                        <span>TARGETS</span>
                        <span class="target-count-badge" id="targetCountBadge">0</span>
                        <span class="section-toggle">&#9660;</span>
                    </div>
                    <div class="section-content">
                        <div class="quick-target-list" id="quickTargetList">
                            <!-- Quick view of targets -->
                            <div class="no-targets-hint">No targets configured</div>
                        </div>
                        <button class="btn btn-primary btn-full mt-10" onclick="openTargetsModal()">
                            &#127919; MANAGE TARGETS
                        </button>
                    </div>
                </div>

                <!-- WARHAMMER Network -->
                <div class="panel-section" id="sectionNetwork">
                    <div class="section-header collapsible" onclick="toggleSection('sectionNetwork')">
                        <span class="section-icon">&#128279;</span>
                        <span>WARHAMMER</span>
                        <span class="network-status-badge" id="networkStatusBadge">OFFLINE</span>
                        <span class="section-toggle">&#9660;</span>
                    </div>
                    <div class="section-content">
                        <div class="network-status-bar">
                            <div class="status-item">
                                <span class="status-label">PEERS:</span>
                                <span class="status-value" id="networkPeerCount">0</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">BK9:</span>
                                <span class="status-value network-bluek9" id="networkBluek9Count">0</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">ONLINE:</span>
                                <span class="status-value network-online" id="networkOnlineCount">0</span>
                            </div>
                        </div>
                        <div class="btn-group mt-10">
                            <button class="btn btn-success" id="btnStartNetwork" onclick="startNetworkMonitor()">
                                &#9654; CONNECT
                            </button>
                            <button class="btn btn-danger" id="btnStopNetwork" onclick="stopNetworkMonitor()" disabled>
                                &#9632; DISCONNECT
                            </button>
                        </div>
                        <div class="toggle-group mt-10">
                            <label class="toggle">
                                <input type="checkbox" id="toggleShowPeers" checked onchange="toggleShowPeers()">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Show Peer Locations</span>
                            </label>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle">
                                <input type="checkbox" id="toggleShowConnections" checked onchange="toggleShowConnections()">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Show Connections</span>
                            </label>
                        </div>
                        <div class="network-settings-link mt-10">
                            <button class="btn btn-secondary btn-sm btn-full" onclick="openSettings('network')">
                                &#9881; Network Settings
                            </button>
                        </div>
                    </div>
                </div>

            </aside>

            <!-- Left Resize Handle -->
            <div class="resize-handle resize-handle-left" id="resizeHandleLeft"></div>

            <!-- Center - Map -->
            <main class="map-container">
                <div id="map"></div>
                <div class="map-overlay-info" id="mapOverlayInfo">
                    <div class="overlay-item">
                        <span class="overlay-label">SELECTED:</span>
                        <span class="overlay-value" id="selectedDevice">NONE</span>
                    </div>
                </div>
            </main>

            <!-- Right Resize Handle -->
            <div class="resize-handle resize-handle-right" id="resizeHandleRight"></div>

            <!-- Right Panel - Survey & Logs -->
            <aside class="panel panel-right" id="panelRight" data-dock="right">
                <div class="panel-header" onmousedown="startPanelDrag(event, 'panelRight')">
                    <span class="panel-header-title">
                        <span>&#9776;</span> SURVEY & DATA
                    </span>
                    <div class="panel-header-controls">
                        <button class="panel-control-btn collapse-btn" onclick="togglePanelCollapse('panelRight')" title="Collapse">&#8722;</button>
                        <button class="panel-control-btn dock-bottom-btn" onclick="toggleBottomDock()" title="Dock to Bottom">&#8615;</button>
                        <button class="panel-control-btn" onclick="swapPanels()" title="Swap Sides">&#8644;</button>
                    </div>
                </div>
                <!-- Survey Table -->
                <div class="panel-section survey-section" id="surveySection">
                    <div class="section-header collapsible" onclick="toggleSection('surveySection')">
                        <span class="section-icon">&#128200;</span>
                        <span>BLUETOOTH SURVEY</span>
                        <span class="device-counter" id="surveyCount">0</span>
                        <span class="section-toggle">&#9660;</span>
                    </div>
                    <!-- Search/Filter Bar -->
                    <div class="survey-toolbar">
                        <div class="survey-search">
                            <input type="text" id="surveySearch" placeholder="Filter by BD address, name, manufacturer..." oninput="filterSurveyTable()">
                            <button class="search-clear" onclick="clearSurveyFilter()" title="Clear filter">&times;</button>
                        </div>
                        <button class="btn btn-sm btn-warning" onclick="clearResults()" title="Clear all results">CLEAR</button>
                    </div>
                    <div class="section-content table-container">
                        <table class="survey-table" id="surveyTable">
                            <thead>
                                <tr>
                                    <th class="sortable" data-sort="bd_address" onclick="sortSurveyTable('bd_address')">BD ADDR <span class="sort-icon"></span></th>
                                    <th class="sortable" data-sort="device_name" onclick="sortSurveyTable('device_name')">NAME <span class="sort-icon"></span></th>
                                    <th class="sortable" data-sort="device_type" onclick="sortSurveyTable('device_type')">TYPE <span class="sort-icon"></span></th>
                                    <th class="sortable" data-sort="rssi" onclick="sortSurveyTable('rssi')">RSSI <span class="sort-icon"></span></th>
                                    <th class="sortable" data-sort="packet_count" onclick="sortSurveyTable('packet_count')">PKTS <span class="sort-icon"></span></th>
                                    <th class="sortable" data-sort="emitter_accuracy" onclick="sortSurveyTable('emitter_accuracy')">CEP <span class="sort-icon"></span></th>
                                    <th class="sortable" data-sort="last_seen" onclick="sortSurveyTable('last_seen')">LAST <span class="sort-icon"></span></th>
                                    <th>ACT</th>
                                </tr>
                            </thead>
                            <tbody id="surveyTableBody">
                                <!-- Devices will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Vertical Resize Handle: Survey <-> Stats -->
                <div class="resize-handle-vertical" id="resizeHandleSurveyStats"></div>

                <!-- Stats Charts -->
                <div class="panel-section chart-section" id="statsSection">
                    <div class="section-header collapsible" onclick="toggleSection('statsSection')">
                        <span class="section-icon">&#128202;</span>
                        <span>STATISTICS</span>
                        <span class="section-toggle">&#9660;</span>
                    </div>
                    <div class="section-content stats-container">
                        <div class="stats-top-row">
                            <div id="signalPulseContainer" class="signal-pulse-container"></div>
                            <div class="stats-grid-compact">
                                <div class="stat-box">
                                    <div class="stat-value" id="statTotalDevices">0</div>
                                    <div class="stat-label">TOTAL</div>
                                </div>
                                <div class="stat-box stat-classic">
                                    <div class="stat-value" id="statClassic">0</div>
                                    <div class="stat-label">CLASSIC</div>
                                </div>
                                <div class="stat-box stat-ble">
                                    <div class="stat-value" id="statBLE">0</div>
                                    <div class="stat-label">BLE</div>
                                </div>
                                <div class="stat-box stat-targets">
                                    <div class="stat-value" id="statTargets">0</div>
                                    <div class="stat-label">TARGETS</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-value" id="statLocated">0</div>
                                    <div class="stat-label">LOCATED</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-value" id="statAvgRSSI">--</div>
                                    <div class="stat-label">AVG RSSI</div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <div class="chart-legend">
                                <span class="legend-item legend-total"><span class="legend-line"></span>TOTAL</span>
                                <span class="legend-item legend-active"><span class="legend-line"></span>ACTIVE</span>
                                <span class="legend-item legend-targets"><span class="legend-line"></span>TARGETS</span>
                            </div>
                            <canvas id="deviceTypeChart"></canvas>
                        </div>
                        <div class="stats-footer">
                            <div class="stat-inline">
                                <span class="stat-label">Session:</span>
                                <span class="stat-value" id="statSessionTime">00:00:00</span>
                            </div>
                            <div class="stat-inline">
                                <span class="stat-label">Top Mfr:</span>
                                <span class="stat-value" id="statTopManufacturer">--</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vertical Resize Handle: Stats <-> Logs -->
                <div class="resize-handle-vertical" id="resizeHandleStatsLogs"></div>

                <!-- Live Logs -->
                <div class="panel-section log-section" id="logsSection">
                    <div class="section-header collapsible" onclick="toggleSection('logsSection')">
                        <span class="section-icon">&#128196;</span>
                        <span>LIVE LOG</span>
                        <div class="header-controls">
                            <button class="btn btn-sm" onclick="event.stopPropagation(); exportCollection('json')" title="Export JSON">&#128190;</button>
                            <button class="btn btn-sm" onclick="event.stopPropagation(); exportCollection('csv')" title="Export CSV">&#128195;</button>
                        </div>
                        <span class="section-toggle">&#9660;</span>
                    </div>
                    <div class="section-content log-container" id="logContainer">
                        <!-- Logs will be populated here -->
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Version Footer -->
    <div class="version-footer">
        <span class="version-text">BlueK9 v3.1.0</span>
        <span class="version-divider">|</span>
        <span class="version-id" id="systemIdFooter">--</span>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // Initialize with Mapbox token and user info
        const MAPBOX_TOKEN = '{{ mapbox_token }}';
        const IS_ADMIN = {{ 'true' if is_admin else 'false' }};
        const CURRENT_USER = '{{ username }}';
        initApp();
    </script>
</body>
</html>
